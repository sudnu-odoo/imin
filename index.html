<!DOCTYPE html>
<html>

<head>
    <title>IMIN Go-Print Example</title>
</head>

<body>
    <h1>Cetak Struk Thermal</h1>
    <button id="btnPrint">üñ®Ô∏è Print Struk</button>

    <!-- Iframe tersembunyi -->
    <iframe id="printSink" style="display:none;"></iframe>

    <script>
        // Helper function
        function wrapCommandText(raw) {
            return `'${String(raw).replace(/\\/g, "\\\\").replace(/'/g, "\\'").replace(/\n/g, "\\n")}'`;
        }

        // Function kirim ke print
        function sendToIframe(commandArray) {
            const commandText = commandArray.join(" + ");
            const printSink = document.getElementById("printSink");
            const doc = printSink.contentDocument || printSink.contentWindow.document;

            doc.open("text/plain");
            doc.write(commandText);
            doc.close();

            printSink.contentWindow.focus();
            setTimeout(() => {
                try {
                    printSink.contentWindow.print();
                } catch (err) {
                    console.error("Print gagal:", err);
                }
            }, 120);
        }

        // Event listener
        document.getElementById("btnPrint").addEventListener("click", () => {
            const now = new Date().toLocaleString('id-ID');

            const commandParts = [
                "COMMANDS.HW_INIT",

                "COMMANDS.TEXT_FORMAT.TXT_ALIGN_CT",
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_ON",
                wrapCommandText("BoostechLab Coffee\n"),
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_OFF",
                wrapCommandText("Web2 POS Thermal\n"),
                wrapCommandText("\n"),

                "COMMANDS.TEXT_FORMAT.TXT_ALIGN_LT",
                wrapCommandText("Kasir : Kasir Mia\n"),
                wrapCommandText("Invoice: INV-001\n"),
                wrapCommandText("2/1/2026, 14.20.27\n"),
                wrapCommandText("Jl. Pos Thermal No. 12\n"),
                wrapCommandText("Jakarta\n"),

                wrapCommandText("--------------------------------\n"),

                wrapCommandText("Signature Espresso\n"),
                wrapCommandText("2 x Rp 25.000,00    Rp 50.000,00\n"),
                wrapCommandText("Butter Croissant\n"),
                wrapCommandText("1 x Rp 21.000,00    Rp 21.000,00\n"),
                wrapCommandText("Nitro Cold Brew\n"),
                wrapCommandText("1 x Rp 36.000,00    Rp 36.000,00\n"),

                wrapCommandText("--------------------------------\n"),
                wrapCommandText("Subtotal            Rp 107.000,00\n"),
                wrapCommandText("Diskon (10%)        -Rp 10.700,00\n"),
                wrapCommandText("Pajak (11%)         Rp 10.593,00\n"),

                "COMMANDS.TEXT_FORMAT.TXT_BOLD_ON",
                wrapCommandText("Grand Total         Rp 106.893,00\n"),
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_OFF",

                wrapCommandText("--------------------------------\n"),
                wrapCommandText("Pembayaran : Debit Card\n"),
                wrapCommandText("\n"),

                "COMMANDS.TEXT_FORMAT.TXT_ALIGN_CT",
                wrapCommandText("Terima kasih telah berbelanja.\n"),
                wrapCommandText("Follow IG @boostechlab\n"),
                wrapCommandText("\n\n\n"),

                "COMMANDS.PAPER_FULL_CUT"
            ];


            sendToIframe(commandParts);
        });
    </script>
</body>

</html>
