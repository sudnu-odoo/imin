<!DOCTYPE html>
<html>

<head>
    <title>IMIN Go-Print Example</title>
</head>

<body>
    <h1>Cetak Struk Thermal</h1>
    <button id="btnPrint">üñ®Ô∏è Print Struk</button>

    <!-- Iframe tersembunyi -->
    <iframe id="printSink" style="display:none;"></iframe>

    <script>
        // Helper function
        function wrapCommandText(raw) {
            return `'${String(raw).replace(/\\/g, "\\\\").replace(/'/g, "\\'").replace(/\n/g, "\\n")}'`;
        }

        // Function kirim ke print
        function sendToIframe(commandArray) {
            const commandText = commandArray.join(" + ");
            const printSink = document.getElementById("printSink");
            const doc = printSink.contentDocument || printSink.contentWindow.document;

            doc.open("text/plain");
            doc.write(commandText);
            doc.close();

            printSink.contentWindow.focus();
            setTimeout(() => {
                try {
                    printSink.contentWindow.print();
                } catch (err) {
                    console.error("Print gagal:", err);
                }
            }, 120);
        }

        // Event listener
        document.getElementById("btnPrint").addEventListener("click", () => {
            const now = new Date().toLocaleString('id-ID');

            const commandParts = [
                "COMMANDS.HW_INIT",                              // Reset printer
                "COMMANDS.TEXT_FORMAT.TXT_ALIGN_CT",            // Center
                "COMMANDS.TEXT_FORMAT.TXT_2HEIGHT",             // Double height
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_ON",             // Bold ON
                wrapCommandText("TOKO SAYA\\n"),                 // Nama toko
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_OFF",
                "COMMANDS.TEXT_FORMAT.TXT_NORMAL",
                wrapCommandText("Jl. Contoh No. 123\\n"),
                wrapCommandText("Telp: 021-12345678\\n\\n"),
                "COMMANDS.HR_58MM",                              // Garis
                "COMMANDS.TEXT_FORMAT.TXT_ALIGN_LT",            // Left
                wrapCommandText("Tanggal: " + now + "\\n\\n"),
                wrapCommandText("Item 1          Rp 10.000\\n"),
                wrapCommandText("Item 2          Rp 15.000\\n"),
                wrapCommandText("Item 3          Rp 20.000\\n"),
                "COMMANDS.HR_58MM",
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_ON",
                wrapCommandText("TOTAL           Rp 45.000\\n"),
                "COMMANDS.TEXT_FORMAT.TXT_BOLD_OFF",
                wrapCommandText("\\n"),
                "COMMANDS.TEXT_FORMAT.TXT_ALIGN_CT",
                wrapCommandText("Terima Kasih\\n"),
                wrapCommandText("Selamat Berbelanja Kembali\\n\\n\\n"),
                "COMMANDS.PAPER_FULL_CUT"                        // Cut paper
            ];

            sendToIframe(commandParts);
        });
    </script>
</body>

</html>
